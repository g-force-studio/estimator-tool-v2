Current focus:
- Resolve Vercel runtime env var availability and unblock job detail/save, photo uploads, and submit flow.

What's working:
- Signed upload flow and job_files recording are implemented in code.
- Auth callback now persists session cookies (magic link should stick).
- Diagnostics in /api/jobs/:id report missing Supabase env vars at runtime.

What's broken:
- Production/preview runtime reports "supabaseKey is required"; env vars appear missing at runtime.
- Old /api/uploads endpoint may still be hit if cached bundles or non-updated paths are used.

Latest files touched:
- app/api/jobs/[id]/route.ts
- app/api/uploads/signed/route.ts
- app/api/uploads/record/route.ts
- app/auth/callback/route.ts
- app/jobs/new/page.tsx
- app/jobs/[id]/page.tsx
- lib/db/upload.ts
- NOTES.md
- code_state.txt

Commands to run locally:
- npm run build

Last successful end-to-end test:
- None since env var/runtime failures; needs verification after redeploy.

Next 3 concrete steps:
1) Redeploy and hit /api/jobs/:id to confirm env diagnostics show no missing vars.
2) Re-test job creation + photo persistence (ensure /api/uploads is not called).
3) Re-test Submit â†’ estimate flow after OPENAI_API_KEY is configured.
