Current focus:
- Restore accurate pricing and eliminate duplicates after resubmits using workspace_pricing_id with safe fallbacks.
- Use debug logs to pinpoint pricing source and matching failures.

What's working:
- Pricing_materials now acts as a global fallback when workspace_pricing_id is unset.
- workspace_pricing_id routing exists in estimate flow (customer override -> workspace -> global).
- Schema/types updated and migration added for workspace_pricing_id fields.
- Build issues from nullable pricing ID and debug logging order resolved.

What's broken / pending:
- Pricing still not populating for the reported job; root cause pending debug logs.
- No dedupe or pricing sanity checks yet; duplicates and factor-of-10 errors remain.

Latest files touched:
- app/api/jobs/[id]/estimate/route.ts
- supabase/schema.sql
- supabase/migrations/20260202_add_workspace_pricing_id.sql
- lib/supabase/database.types.ts
- .gitignore
- deno.lock
- NOTES.md
- code_state.txt

Commands to run locally:
- npm run build

Next 3 concrete steps:
1) Re-submit estimate with ?debug=1 and capture logs.
2) Implement deterministic dedupe of AI items vs user line items.
3) Add pricing sanity checks (unit mismatch / low confidence) and fallback handling.
